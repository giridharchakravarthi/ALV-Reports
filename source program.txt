TYPE-POOLS SLIS.
TABLES EKKO.
DATA : IT_FCAT TYPE SLIS_T_FIELDCAT_ALV,
       WA_FCAT LIKE LINE OF IT_FCAT.
DATA : WA_LAY TYPE SLIS_LAYOUT_ALV.
DATA : IT_EVENT TYPE SLIS_T_EVENT,
       WA_EVENT LIKE LINE OF IT_EVENT.
SELECTION-SCREEN BEGIN OF BLOCK A WITH FRAME TITLE TEXT-001.
SELECTION-SCREEN SKIP 2.
SELECT-OPTIONS S_EBELN FOR EKKO-EBELN.
SELECTION-SCREEN SKIP 2.
SELECT-OPTIONS S_BEDAT FOR EKKO-BEDAT.
SELECTION-SCREEN SKIP 2.
PARAMETER LIM AS CHECKBOX DEFAULT 'X'.
SELECTION-SCREEN END OF BLOCK A.
SELECTION-SCREEN BEGIN OF SCREEN 100.
PARAMETER LOW TYPE EKPO-NETPR.
SELECTION-SCREEN SKIP 2.
SELECTION-SCREEN BEGIN OF LINE.
PARAMETER LR RADIOBUTTON GROUP B DEFAULT 'X'.
SELECTION-SCREEN COMMENT 3(5) TEXT-002.
PARAMETER LG RADIOBUTTON GROUP B.
SELECTION-SCREEN COMMENT 10(6) TEXT-003.
PARAMETER LB RADIOBUTTON GROUP B.
SELECTION-SCREEN COMMENT 20(15) TEXT-004.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN SKIP 2.
PARAMETER HIGH TYPE EKPO-NETPR.
SELECTION-SCREEN SKIP 2.
SELECTION-SCREEN BEGIN OF LINE.
PARAMETER HR RADIOBUTTON GROUP C.
SELECTION-SCREEN COMMENT 3(5) TEXT-002.
PARAMETER HG RADIOBUTTON GROUP C DEFAULT 'X'.
SELECTION-SCREEN COMMENT 10(6) TEXT-003.
PARAMETER HB RADIOBUTTON GROUP C.
SELECTION-SCREEN COMMENT 20(15) TEXT-004.
SELECTION-SCREEN END OF LINE.
SELECTION-SCREEN END OF SCREEN 100.
IF LIM = 'X'.
  CALL SELECTION-SCREEN 100.
ENDIF.
AT SELECTION-SCREEN.
SELECT SINGLE EBELN,BEDAT FROM EKKO INTO @DATA(S_WA) WHERE EBELN IN @S_EBELN AND BEDAT IN @S_BEDAT.
IF SY-SUBRC <> 0.
MESSAGE 'NO DATA FOUND AS PER REQUIREMENT' TYPE 'E'.
ENDIF.
START-OF-SELECTION.
SELECT EKKO~EBELN,EKKO~BEDAT,EKKO~LIFNR,EKKO~BUKRS,EKPO~EBELP,EKPO~MATNR,EKPO~MENGE,EKPO~MEINS,EKPO~NETPR,
CASE
WHEN NETPR <= @LOW AND @LR = 'X' THEN 'C610'
WHEN NETPR <= @LOW AND @LG = 'X' THEN 'C510'
WHEN NETPR <= @LOW AND @LB = 'X' THEN 'C410'
WHEN NETPR >= @HIGH AND @HR = 'X' THEN 'C610'
WHEN NETPR >= @HIGH AND @HG = 'X' THEN 'C510'
WHEN NETPR >= @HIGH AND @HG = 'X' THEN 'C410'
ELSE ' '
END AS COL
FROM EKKO INNER JOIN EKPO ON EKKO~EBELN = EKPO~EBELN
INTO TABLE @DATA(IT)
WHERE EKKO~EBELN IN @S_EBELN AND EKKO~BEDAT IN @S_BEDAT.
WA_FCAT-FIELDNAME = 'EBELN'.
WA_FCAT-COL_POS = '1'.
WA_FCAT-SELTEXT_M = 'DOCUMENT NUMBER'.
APPEND WA_FCAT TO IT_FCAT.
CLEAR WA_FCAT.
WA_FCAT-FIELDNAME = 'BEDAT'.
WA_FCAT-COL_POS = '2'.
WA_FCAT-SELTEXT_M = 'DATE'.
APPEND WA_FCAT TO IT_FCAT.
CLEAR WA_FCAT.
WA_FCAT-FIELDNAME = 'LIFNR'.
WA_FCAT-COL_POS = '3'.
WA_FCAT-SELTEXT_M = 'VENDOR'.
APPEND WA_FCAT TO IT_FCAT.
CLEAR WA_FCAT.
WA_FCAT-FIELDNAME = 'BUKRS'.
WA_FCAT-COL_POS = '4'.
WA_FCAT-SELTEXT_M = 'COMPANY'.
APPEND WA_FCAT TO IT_FCAT.
CLEAR WA_FCAT.
WA_FCAT-FIELDNAME = 'EBELP'.
WA_FCAT-COL_POS = '5'.
WA_FCAT-SELTEXT_M = 'TYPE'.
APPEND WA_FCAT TO IT_FCAT.
CLEAR WA_FCAT.
WA_FCAT-FIELDNAME = 'MATNR'.
WA_FCAT-COL_POS = '6'.
WA_FCAT-SELTEXT_M = 'MATERIAL'.
APPEND WA_FCAT TO IT_FCAT.
CLEAR WA_FCAT.
WA_FCAT-FIELDNAME = 'MENGE'.
WA_FCAT-COL_POS = '7'.
WA_FCAT-SELTEXT_M = 'QUANTITY'.
APPEND WA_FCAT TO IT_FCAT.
CLEAR WA_FCAT.
WA_FCAT-FIELDNAME = 'MEINS'.
WA_FCAT-COL_POS = '8'.
WA_FCAT-SELTEXT_M = 'UNITS'.
APPEND WA_FCAT TO IT_FCAT.
CLEAR WA_FCAT.
WA_FCAT-FIELDNAME = 'NETPR'.
WA_FCAT-COL_POS = '9'.
WA_FCAT-SELTEXT_M = 'PRICE'.
APPEND WA_FCAT TO IT_FCAT.
CLEAR WA_FCAT.
WA_LAY-INFO_FIELDNAME = 'COL'.
WA_LAY-ZEBRA = 'X'.
*WA_LAY-COLWIDTH_OPTIMIZE = 'X'.
WA_EVENT-NAME = 'USER_COMMAND'.
WA_EVENT-FORM = 'UC'.
APPEND WA_EVENT TO IT_EVENT.
CLEAR WA_EVENT.
WA_EVENT-NAME = 'PF_STATUS_SET'.
WA_EVENT-FORM = 'GUI'.
APPEND WA_EVENT TO IT_EVENT.
CLEAR WA_EVENT.
WA_EVENT-NAME = 'TOP_OF_PAGE'.
WA_EVENT-FORM = 'TOP'.
APPEND WA_EVENT TO IT_EVENT.
CLEAR WA_EVENT.
END-OF-SELECTION.
CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
  EXPORTING
    I_CALLBACK_PROGRAM                =  SY-CPROG
    IS_LAYOUT                         =  WA_LAY
    IT_FIELDCAT                       =  IT_FCAT
    IT_EVENTS                         =  IT_EVENT
  TABLES
    T_OUTTAB                          =  IT.
FORM GUI USING M TYPE SLIS_T_EXTAB.
SET PF-STATUS 'STAT'.
ENDFORM.
FORM UC USING A LIKE SY-UCOMM B TYPE SLIS_SELFIELD.
IF SY-UCOMM = 'DOWN'.
CALL FUNCTION 'DOWNLOAD'
  TABLES
    DATA_TAB      = IT.
ELSEIF B-FIELDNAME = 'LIFNR'.
SET PARAMETER ID 'LIF' FIELD B-VALUE.
CALL TRANSACTION 'XK03'.
ELSEIF B-FIELDNAME = 'MATNR'.
SET PARAMETER ID 'MAT' FIELD B-VALUE.
CALL TRANSACTION 'MM03'.
ELSEIF B-FIELDNAME = 'EBELN'.
SET PARAMETER ID 'BES' FIELD B-VALUE.
CALL TRANSACTION 'ME23N'.
ENDIF.
ENDFORM.
FORM TOP.
DATA : IT_TOP TYPE SLIS_T_LISTHEADER,
       WA_TOP LIKE LINE OF IT_TOP.
WA_TOP-INFO = 'PURCHASE DOCUMENT DETAILS'.
WA_TOP-TYP = 'H'.
APPEND WA_TOP TO IT_TOP.
CALL FUNCTION 'REUSE_ALV_COMMENTARY_WRITE'
  EXPORTING
    IT_LIST_COMMENTARY       = IT_TOP
    I_LOGO                   = 'AMAZON'.
ENDFORM.